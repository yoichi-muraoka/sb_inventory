<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.inventory.mapper.PlacementMapper">

	<resultMap type="com.example.inventory.domain.Placement" id="roomMap">
		<result column="amount" property="amount" />
		<result column="name" property="room.name" />
	</resultMap>

	<select id="selectByItemId"  resultMap="roomMap" parameterType="int">
		SELECT r.name, p.amount
		FROM placements AS p
		JOIN rooms AS r
		ON p.room_id = r.id
		WHERE p.item_id = #{itemId}
		ORDER BY r.id;
	</select>

	<select id="countDistinctByItemId" resultType="long">
		SELECT COUNT(DISTINCT item_id) FROM placements;
	</select>

	<select id="countByRoomId" resultType="long"
	 parameterType="string">
		SELECT COUNT(*) FROM placements
		WHERE room_id = #{roomId};
	</select>

	<delete id="deleteByItemId" parameterType="int">
		DELETE FROM placements WHERE item_id = #{itemId};
	</delete>

	<insert id="insert" parameterType="com.example.inventory.domain.Placement">
		INSERT INTO placements (item_id, room_id, amount)
		VALUES (#{item.id}, #{room.id}, #{amount});
	</insert>

</mapper>